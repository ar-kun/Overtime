@model IEnumerable<API.DTOs.Overtimes.OvertimeDto>, API.DTOs.Overtimes.CreateOvertimeDto
@{
    ViewData["Title"] = "Dashboard | Schedule";
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
}

<div id="overtimeList"></div>
<div class="flex px-16 gap-10 py-5 max-h-screen">
    <section class="w-1/5 bg-gradient-to-r from-third to-secondary rounded-2xl text-white" id="sidebar">
        <img src="~/img/logo.png" alt="" class="px-5 pt-5" />
        <div class="border-b-2 border-primary border-dashed w-full mb-4"></div>
        <div class="px-10 text-xl my-2">
            <a href="" class="flex items-center gap-5">
                <i class="fa-regular fa-calendar-check"></i>
                <p>Dashboard</p>
            </a>
            <div class="border-b-2 border-primary w-full mb-4"></div>
        </div>
        <div class="px-10 text-xl my-2">
            <a href="" class="flex items-center gap-5">
                <i class="fa-regular fa-rectangle-list"></i>
                <p>Overtime</p>
            </a>
        </div>
        <div class="px-10 text-xl my-2">
            <a href="" class="flex items-center gap-5">
                <i class="fa-solid fa-users"></i>
                <p>Employees</p>
            </a>
        </div>
        <div class="px-10 text-xl my-2">
            <a href="/Logout" class="flex items-center gap-5">
                <i class="fa-solid fa-arrow-right-from-bracket"></i>
                <p>Logout</p>
            </a>
        </div>
    </section>
    <section class="w-4/5 backdrop-blur-md text-third px-10 py-10 relative rounded-2xl" id="schedule">
        <div class="">
            <div class="flex flex-wrap justify-between items-center mb-10">
                <h1 class="text-3xl font-bold">Overtime Management</h1>
                <div class="flex gap-5 items-center">
                    <a href="" class="bg-third px-5 py-2 rounded-lg shadow-md text-white shadow-slate-600 hover:bg-secondary hover:shadow-none">Transkip Gaji</a>
                    <a href=""><i class="fa-regular fa-bell text-2xl"></i></a>
                    <div class="w-14 h-1/4rounded-full">
                        <img src="~/img/profile.png" alt="" class="" />
                    </div>
                </div>
                <div class="border-b-2 border-slate-700 border-dashed w-full"></div>
            </div>
            <div class="">
                <div class="flex justify-between" id="month">
                    <i class="fa-solid fa-chevron-left" id="prev"></i>
                    <p class="text-2xl" id="date"></p>
                    <i class="fa-solid fa-chevron-right" id="next"></i>
                </div>
                <div class="flex px-[20px] [&>p]:w-[calc(100%/7)] [&>p]:flex [&>p]:items-center [&>p]:justify-center [&>p]:text-xl py-5" id="weekdays">
                    <p>Sun</p>
                    <p>Mon</p>
                    <p>Tue</p>
                    <p>Wed</p>
                    <p>Thu</p>
                    <p>Fri</p>
                    <p>Sat</p>
                </div>
                <div class="w-full flex flex-wrap justify-between py-0 px-[20px] text-lg font-bold mb-[20px] [&>*]:w-[calc(100%/7)] [&>*]:h-[70px] [&>*]:flex [&>*]:items-center [&>*]:justify-center [&>*]:cursor-pointer"
                     id="days"></div>

                <div class="flex justify-between" id="goto-today">
                    <div class="flex items-center bg-third px-3 py-2 gap-5 rounded-md shadow-md shadow-slate-600">
                        <input type="text"
                               placeholder="mm/yyyy"
                               class="py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                               placeholder=" "
                               required
                               id="date-input" />
                        <button class="bg-primary p-2 text-third rounded-md hover:bg-secondary hover:text-primary" id="goto-btn">Go</button>
                    </div>
                    <button class="hover:text-third" id="today-btn">Today</button>
                </div>
            </div>
        </div>
    </section>
</div>

@*<script src="~/js/schedule.js"></script>*@
<script>
    var overtimeData = @Html.Raw(Json.Serialize(Model));


    const schedule = document.querySelector('#schedule');
    const date = document.querySelector('#date');
    const daysContainer = document.querySelector('#days');
    const prev = document.querySelector('#prev');
    const next = document.querySelector('#next');
    const todayBtn = document.querySelector('#today-btn');
    const gotoBtn = document.querySelector('#goto-btn');
    const dateInput = document.querySelector('#date-input');

    let today = new Date();
    let activeDate;
    let month = today.getMonth();
    let year = today.getFullYear();

    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'Octobor', 'November', 'Desember'];

    //  add to days
    const initCalender = (data) => {
        
        for (var i = 0; i < data.length; i++) {
             var overtimeItem = data[i];
             var date = new Date(overtimeItem.dateRequest).getDate().toString().padStart(2, '0');
                
             console.log(data);

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            const prevDays = prevLastDay.getDate();
            const lastDate = lastDay.getDate();
            const day = firstDay.getDay();
            const nextDays = 7 - lastDay.getDay() - 1;

            date.innerHTML = `${months[month]} ${year}`;

            let days = '';
            const randomId = Math.random().toString(36).substring(2, 10);

            //prev month days
            for (let x = day; x > 0; x--) {
                days += `<div class="prev-date" >${prevDays - x + 1}</div>`;
            }

            //Curret month days
            for (let i = 1; i <= lastDate; i++) {
                
                if (date == i) {
                    if (i === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear()) {
                        days += `<div class="today event">${i}</div>`;
                    } else {
                        const isWeekday = new Date(year, month, i).getDay() === 0 || new Date(year, month, i).getDay() === 6 ? 1 : 0;

                        days += `
                  <div>
                        <div class="hover:bg-secondary/75 hover:text-primary rounded-lg py-5 px-[3.75rem] event" id="${i}-${randomId}" data-modal-target="default-${i}-${randomId}" data-modal-toggle="default-${i}-${randomId}">${i}</div>

                  <!-- modal -->
                <div
                 id="default-${i}-${randomId}"
                 tabindex="-1"
                 aria-hidden="true"
                 class="hidden absolute bg-secondary/50 w-full h-full top-0 left-0 flex justify-center items-center ease-out transition-all duration-300 backdrop-blur-md text-primary rounded-xl"
                >
                 <div class="bg-third w-1/2 rounded-lg p-5 relative shadow-md shadow-slate-500">
                  <div class="flex px-5 py-2 gap-5" id="today-date">
                   <div class="" id="event-day">Wed</div>
                   <div class="" id="event-date">${i}th ${months[month]} ${year}</div>
                  </div>
                  <div class="absolute right-0 top-0 text-3xl p-5">
                   <i class="fas fa-times" data-modal-close="default-${i}-${randomId}"></i>
                  </div>
                  <div class="" id="events"></div>
                  <div class="flex items-center" id="add-event-wrapper">
                       <form asp-action="Index" class="w-full">
                           <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="relative z-0 w-full mb-6 group">
                     <input
                      type="date"
                      asp-for="DateRequest"
                      name="DateRequest"
                      id="DateRequest"
                      class="hidden py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                      placeholder=" "
                      value="${year}-${month + 1}-${i < 10 ? '0' + i : i}"
                      required
                      readonly
                     />
                    </div>
                    <div class="relative z-0 w-full mb-6 group">
                     <input
                      type="number"
                      asp-for="Duration"
                      name="Duration"
                      id="Duration"
                      class="block py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                      placeholder=" "
                      required
                     />
                     <label
                      for="floating_duration"
                      class="peer-focus:font-medium absolute text-sm text-primary dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                      >Duration</label
                     >
                    </div>

                    <div class="relative z-0 w-full mb-6 group">
                     <input
                      type="text"
                      asp-for="Remarks"
                      name="Remarks"
                      id="Remarks"
                      class="block py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                      placeholder=" "
                      required
                     />
                     <label
                      for="floating_remarks"
                      class="peer-focus:font-medium absolute text-sm text-primary dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                      >Remarks</label
                     >
                    </div>
                    <div class="relative z-0 w-full mb-6 group">
                     <input
                      type="number"
                      asp-for="TypeOfDay"
                      name="TypeOfDay"
                      id="TypeOfDay"
                      class="hidden py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                      placeholder=" "
                      value="${isWeekday}"
                      required
                      readonly
                     />
                    </div>

                    <div
                     class="group bg-primary rounded-xl text-center hover:bg-secondary focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium text-sm w-full sm:w-auto px-5 py-2.5 dark:bg-third dark:hover:bg-bg-secondary dark:focus:ring-secondary shadow-md shadow-slate-500"
                    >
                     <button type="submit" class="text-third text-lg group-hover:text-primary">Send Request Overtime</button>
                    </div>
                   </form>
                  </div>
                 </div>
                </div>
                  </div>
                  `;
                    }
                } else {
                    if (i === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear()) {
                        days += `<div class="today">${i}</div>`;
                    } else {
                        const isWeekday = new Date(year, month, i).getDay() === 0 || new Date(year, month, i).getDay() === 6 ? 1 : 0;

                        days += `
                  <div>
                    <div class="hover:bg-secondary/75 hover:text-primary rounded-lg py-5 px-[3.75rem]" id="${i}-${randomId}" data-modal-target="default-${i}-${randomId}" data-modal-toggle="default-${i}-${randomId}">${i}</div>

                  <!-- modal -->
                <div
                 id="default-${i}-${randomId}"
                 tabindex="-1"
                 aria-hidden="true"
                 class="hidden absolute bg-secondary/50 w-full h-full top-0 left-0 flex justify-center items-center ease-out transition-all duration-300 backdrop-blur-md text-primary rounded-xl"
                >
                 <div class="bg-third w-1/2 rounded-lg p-5 relative shadow-md shadow-slate-500">
                  <div class="flex px-5 py-2 gap-5" id="today-date">
                   <div class="" id="event-day">Wed</div>
                   <div class="" id="event-date">${i}th ${months[month]} ${year}</div>
                  </div>
                  <div class="absolute right-0 top-0 text-3xl p-5">
                   <i class="fas fa-times" data-modal-close="default-${i}-${randomId}"></i>
                  </div>
                  <div class="" id="events"></div>
                  <div class="flex items-center" id="add-event-wrapper">
                       <form asp-action="Index" class="w-full">
                           <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="relative z-0 w-full mb-6 group">
                     <input
                      type="date"
                      asp-for="DateRequest"
                      name="DateRequest"
                      id="DateRequest"
                      class="hidden py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                      placeholder=" "
                      value="${year}-${month + 1}-${i < 10 ? '0' + i : i}"
                      required
                      readonly
                     />
                    </div>
                    <div class="relative z-0 w-full mb-6 group">
                     <input
                      type="number"
                      asp-for="Duration"
                      name="Duration"
                      id="Duration"
                      class="block py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                      placeholder=" "
                      required
                     />
                     <label
                      for="floating_duration"
                      class="peer-focus:font-medium absolute text-sm text-primary dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                      >Duration</label
                     >
                    </div>

                    <div class="relative z-0 w-full mb-6 group">
                     <input
                      type="text"
                      asp-for="Remarks"
                      name="Remarks"
                      id="Remarks"
                      class="block py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                      placeholder=" "
                      required
                     />
                     <label
                      for="floating_remarks"
                      class="peer-focus:font-medium absolute text-sm text-primary dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                      >Remarks</label
                     >
                    </div>
                    <div class="relative z-0 w-full mb-6 group">
                     <input
                      type="number"
                      asp-for="TypeOfDay"
                      name="TypeOfDay"
                      id="TypeOfDay"
                      class="hidden py-2.5 px-0 w-full text-sm text-primary bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                      placeholder=" "
                      value="${isWeekday}"
                      required
                      readonly
                     />
                    </div>

                    <div
                     class="group bg-primary rounded-xl text-center hover:bg-secondary focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium text-sm w-full sm:w-auto px-5 py-2.5 dark:bg-third dark:hover:bg-bg-secondary dark:focus:ring-secondary shadow-md shadow-slate-500"
                    >
                     <button type="submit" class="text-third text-lg group-hover:text-primary">Send Request Overtime</button>
                    </div>
                   </form>
                  </div>
                 </div>
                </div>
                  </div>
                  `;
                    }
                }
                
            }

            //next month days

            for (let j = 1; j <= nextDays; j++) {
                days += `<div class="next-date" >${j}</div>`;
            }

            daysContainer.innerHTML = days;
         }
        
    };

    initCalender(overtimeData);

    //  prev month
    const prevMonth = () => {
        month--;
        if (month < 0) {
            month = 11;
            year--;
        }
        initCalender();
    };

    //  next month
    const nextMonth = () => {
        month++;
        if (month > 11) {
            month = 0;
            year++;
        }
        initCalender();
    };

    //event next and prev
    prev.addEventListener('click', prevMonth);
    next.addEventListener('click', nextMonth);

    //Our calender is ready
    todayBtn.addEventListener('click', () => {
        today = new Date();
        month = today.getMonth();
        year = today.getFullYear();
        initCalender();
    });

    //Go to date
    dateInput.addEventListener('input', (e) => {
        dateInput.value = dateInput.value.replace(/[^0-9/]/g, '');
        if (dateInput.value.length === 2) {
            dateInput.value += '/';
        }
        if (dateInput.value.length > 7) {
            dateInput.value = dateInput.value.slice(0, 7);
        }
        if (e.inputType === 'deleteContentBackward') {
            if (dateInput.value.length === 3) {
                dateInput.value = dateInput.value.slice(0, 2);
            }
        }
    });

    const gotoDate = () => {
        const dateArr = dateInput.value.split('/');
        if (dateArr.length === 2) {
            if (dateArr[0] > 0 && dateArr[0] < 13 && dateArr[1].length === 4) {
                month = dateArr[0] - 1;
                year = dateArr[1];
                initCalender();
                return;
            }
        }
        alert('Invalid Date');
    };
    gotoBtn.addEventListener('click', gotoDate);

    const modalTriggers = document.querySelectorAll('[data-modal-toggle]');
    const modalCloseTriggers = document.querySelectorAll('[data-modal-close]');

    modalTriggers.forEach((trigger) => {
        trigger.addEventListener('click', () => {
            const targetId = trigger.getAttribute('data-modal-target');
            const targetModal = document.getElementById(targetId);
            if (targetModal) {
                targetModal.classList.remove('hidden');
            }
        });
    });

    modalCloseTriggers.forEach((closeTrigger) => {
        closeTrigger.addEventListener('click', () => {
            const targetId = closeTrigger.getAttribute('data-modal-close');
            const targetModal = document.getElementById(targetId);
            if (targetModal) {
                targetModal.classList.add('hidden');
            }
        });
    });

</script>
